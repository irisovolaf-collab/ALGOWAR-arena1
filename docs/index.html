// –ü–†–û–í–ï–†–ö–ê –ó–ê–ì–†–£–ó–ö–ò
console.log("Script active!");

// –ü–ê–†–ê–ú–ï–¢–†–´
let stage = 1, credits = 0, energy = 0;
let player = { hp: 100, maxHp: 100, atk: 40 };
let enemy = { name: "CODE-TITAN", hp: 200, maxHp: 200, atk: 15 };

// –û–ë–ù–û–í–õ–ï–ù–ò–ï –≠–ö–†–ê–ù–ê
function updateUI() {
    document.getElementById('stage-title').innerText = "SECTOR " + stage;
    document.getElementById('credits-display').innerText = "Credits: " + credits;
    document.getElementById('energy-bar').style.width = energy + "%";
    document.getElementById('ult-button').style.display = (energy >= 100) ? "inline-block" : "none";
    
    document.getElementById('player-hp-bar').style.width = (player.hp / player.maxHp * 100) + "%";
    document.getElementById('enemy-hp-bar').style.width = (enemy.hp / enemy.maxHp * 100) + "%";
    document.getElementById('player-hp-text').innerText = Math.round(player.hp) + "/" + player.maxHp;
    document.getElementById('enemy-hp-text').innerText = Math.round(enemy.hp) + "/" + enemy.maxHp;
}

function print(msg) {
    const log = document.getElementById('log');
    log.innerHTML += `<p>${msg}</p>`;
    log.scrollTop = log.scrollHeight;
}

// –ì–õ–û–ë–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò (–¥–æ—Å—Ç—É–ø–Ω—ã –∫–Ω–æ–ø–∫–∞–º)
window.attack = function(type) {
    console.log("Action: " + type);
    if (player.hp <= 0 || enemy.hp <= 0) return;

    if (type === 'quick') { enemy.hp -= player.atk * 0.8; energy = Math.min(100, energy + 20); print("‚öîÔ∏è –ë—ã—Å—Ç—Ä—ã–π —É–¥–∞—Ä!"); }
    if (type === 'heavy') { enemy.hp -= player.atk * 1.5; energy = Math.min(100, energy + 35); print("üî® –¢—è–∂–µ–ª—ã–π —É–¥–∞—Ä!"); }
    if (type === 'heal') { player.hp = Math.min(player.maxHp, player.hp + 40); print("üîß –†–µ–º–æ–Ω—Ç —Å–∏—Å—Ç–µ–º—ã."); }
    if (type === 'ult') { enemy.hp -= player.atk * 4; energy = 0; print("üöÄ –ü–ï–†–ï–ì–†–£–ó–ö–ê!"); }

    updateUI();

    if (enemy.hp > 0) {
        setTimeout(() => {
            let d = Math.round(enemy.atk + Math.random() * 5);
            player.hp -= d;
            print("ü§ñ –í—Ä–∞–≥ –Ω–∞–Ω–µ—Å " + d + " —É—Ä–æ–Ω–∞.");
            document.body.classList.add('shake');
            setTimeout(() => document.body.classList.remove('shake'), 200);
            updateUI();
        }, 500);
    } else {
        credits += 125;
        print("üèÜ –°–µ–∫—Ç–æ—Ä –æ—á–∏—â–µ–Ω!");
        document.getElementById('battle-actions').classList.add('hidden');
        document.getElementById('shop-actions').classList.remove('hidden');
    }
};

window.buy = function(item) {
    if (credits >= 100) {
        credits -= 100;
        if (item === 'atk') player.atk += 15;
        if (item === 'hp') { player.maxHp += 50; player.hp = player.maxHp; }
        updateUI();
    }
};

window.nextLevel = function() {
    stage++;
    enemy.maxHp = Math.round(200 * Math.pow(1.2, stage - 1));
    enemy.hp = enemy.maxHp;
    enemy.atk += 5;
    document.getElementById('battle-actions').classList.remove('hidden');
    document.getElementById('shop-actions').classList.add('hidden');
    updateUI();
};

// –°–¢–ê–†–¢
window.onload = () => {
    print("–°–∏—Å—Ç–µ–º–∞ –∑–∞–ø—É—â–µ–Ω–∞...");
    updateUI();
};